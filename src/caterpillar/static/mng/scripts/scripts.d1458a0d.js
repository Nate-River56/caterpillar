"use strict";angular.module("caterpillarApp",["ngCookies","ngResource","ui.bootstrap","ngRoute"]).config(["$routeProvider","$httpProvider",function(a,b){a.when("/",{redirectTo:"/queryPage"}).when("/about",{templateUrl:"views/about.html",controller:"AboutCtrl"}).when("/putPage/:id",{templateUrl:"views/putpage.html",controller:"PutpageCtrl",resolve:{method:function(){return"PUT"}}}).when("/postPage",{templateUrl:"views/putpage.html",controller:"PutpageCtrl",resolve:{method:function(){return"POST"}}}).when("/queryPage",{templateUrl:"views/querypage.html",controller:"QuerypageCtrl"}).when("/getPage/:id",{templateUrl:"views/getpage.html",controller:"GetpageCtrl"}).otherwise({redirectTo:"/queryPage"}),b.responseInterceptors.push(["$q","$window",function(a,b){return function(c){return c.then(function(a){return a},function(c){return 0!==c.status&&b.alert("予期しないエラー stauts:"+c.status),a.reject(c)})}}])}]),function(){var a=function(a){"mockhost"===location.hostname&&document.write('<script type="text/javascript" src="'+a+'"></script>')};a("bower_components/angular-mocks/angular-mocks.js"),a("scripts/app-mock.js")}(),angular.module("caterpillarApp").controller("MainCtrl",["$scope",function(a){a.awesomeThings=["HTML5 Boilerplate","AngularJS","Karma"]}]),angular.module("caterpillarApp").controller("AboutCtrl",["$scope",function(a){a.awesomeThings=["HTML5 Boilerplate","AngularJS","Karma"]}]),angular.module("caterpillarApp").service("Page",["$resource",function(a){return a("/caterpillar/api/pages/:id",{id:"@id"},{query:{method:"GET",url:"/caterpillar/api/pages",isArray:!0},update:{method:"PUT"},register:{method:"POST"},getLeaves:{method:"GET",url:"/caterpillar/api/leaves",isArray:!0}})}]),angular.module("caterpillarApp").service("Property",["$resource",function(a){return a("/caterpillar/api/property/:name",{id:"@name"},{query:{method:"GET",url:"/caterpillar/api/properties",isArray:!0},update:{method:"PUT"},register:{method:"POST"}})}]),angular.module("caterpillarApp").controller("QuerypageCtrl",["$scope","$window","Page","Rootpage",function(a,b,c,d){a.pages=c.query(),a.criteria={},a.makeRoot=function(c){angular.forEach(a.pages,function(a){a._hover=null}),b.confirm("URLのルート(http://xxxx/)で表示されるページを変更します。\nよろしいですか？")&&d.update({pageId:c.id}).$promise.then(function(){angular.forEach(a.pages,function(a){a.root=c===a?!0:!1})})}}]),angular.module("caterpillarApp").controller("GetpageCtrl",["$scope","$routeParams","Page",function(a,b,c){a.page=c.get({id:b.id?b.id:null})}]),angular.module("caterpillarApp").controller("PutpageCtrl",["$scope","Page","Property","$routeParams","$timeout","$http","method",function(a,b,c,d,e,f,g){a.method=g,a.page={},a.page.properties={},"PUT"===g?a.page=b.get({id:d.id?d.id:null}):(a.page={},a.page.properties={}),a.leaves=b.getLeaves(),a.leaves.$promise.then(function(c){"PUT"===g&&(a.page=b.get({id:d.id?d.id:null}),a.page.$promise.then(function(b){a.originalPage=angular.copy(b);for(var d=0;d<c.length;d++){var e=c[d];if(e.name===b.leaf){a.leaf=e;break}}a.loadProperties()}))});var h=function(b){c.get({name:b},function(c){a.page.properties[b]=c.value})};a.loadProperties=function(){if(void 0!==a.leaf.wormholes)for(var b=0;b<a.leaf.wormholes.length;b++){var c=a.leaf.wormholes[b];"PROPERTY"===c.type&&(c.global?h(c.name):void 0!==a.originalPage&&void 0!==a.originalPage.properties&&(a.page.properties[c.name]=a.originalPage.properties[c.name]))}},a.showProperties=function(a){return void 0!==a&&"PROPERTY"===a.type},a.validateNotAllNumbers=function(){a.updatePageForm.alias.$error.allnumbers=void 0!==a.page.alias&&""!==a.page.alias&&a.page.alias.match(/^[0-9]*$/)?!0:!1},a.submit=function(){if(a.alerts=[],!a.updatePageForm.$valid||a.updatePageForm.alias.$error.allnumbers)return void a.alerts.push({type:"danger",msg:"入力に不備がある為保存に失敗しました。\n各項目を見直して下さい。"});a.page.leaf=a.leaf.name;for(var c=0;c<a.leaf.wormholes.length;c++){var d=a.leaf.wormholes[c];if("PROPERTY"===d.type){var f=a.page.properties[d.name];void 0===f&&(a.page.properties[d.name]="")}}var g=+new Date,h=100,i=function(b){b(a.page,function(){var b=+new Date-g;e(function(){a.alerts.push({type:"success",msg:"保存に成功しました。"})},b>=h?0:h-b)},function(){var b=+new Date-g;e(function(){a.alerts.push({type:"danger",msg:"保存に失敗しました。"})},b>=h?0:h-b)})};i(void 0===a.page.id?b.register:b.update)},a.closeAlert=function(b){a.alerts.splice(b,1)}}]),angular.module("caterpillarApp").service("Rootpage",["$resource",function(a){return a("/caterpillar/api/rootPage",{},{update:{method:"PUT"}})}]);